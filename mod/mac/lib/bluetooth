# shellcheck shell=dash

___x_cmd_mac_bluetooth(){
    [ "$#" -gt 0 ] || set -- status

    local op="$1";  shift
    case "$op" in
        enable|disable|status)
            ___x_cmd_mac_bluetooth_"$op" "$@"
    esac
}

___x_cmd_mac_bluetooth_enable(){
    ___x_cmd_mac_bluetooth___ctrl 1
}

___x_cmd_mac_bluetooth_disable(){
    ___x_cmd_mac_bluetooth___ctrl 0
}

___x_cmd_mac_bluetooth___ctrl(){
    # sudo defaults write /Library/Preferences/com.apple.Bluetooth ControllerPowerState -int $1 && \
    #         sudo killall -HUP bluetoothd
    ___x_cmd sudo bash -c "
        defaults write /Library/Preferences/com.apple.Bluetooth ControllerPowerState -int $1 && killall -HUP bluetoothd
    "
}

# TODO: The domain/default pair of (/Library/Preferences/com.apple.Bluetooth, ControllerPowerState) does not exist
___x_cmd_mac_bluetooth_status(){
    if [ "$(___x_cmd_mac___cmd defaults read /Library/Preferences/com.apple.Bluetooth ControllerPowerState)" = 1 ]; then
        printf "Bluetooth: %s\n" ON
    else
        printf "Bluetooth: %s\n" OFF
    fi
}

